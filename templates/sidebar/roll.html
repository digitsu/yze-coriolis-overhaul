<div class="dice-roll yzecoriolis">
  <div>
    <h2 style="white-space: pre-wrap;">{{title}}</h2>
    <table style="border: 0;">
      <!-- additional roll-infos for pc -->
      {{#if_eq (AdditionalRollInfos) 'pc'}}
        {{#if_eq actorType 'character'}}
          {{#if_eq rollType 'weapon'}}
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Damage"}}: {{damage}} {{#if damageText}}({{damageText}}){{/if}}{{#if combatOverhaul}}{{#if_gt armorPenetration 0}} | {{localize "YZECORIOLIS.ArmorPenetrationShort"}}: {{armorPenetration}}{{/if_gt}}{{/if}}</td>
            </tr>
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Crit"}}: {{#if_gt crit 0}}{{crit}}{{else}}-{{/if_gt}} {{#if critText}}({{critText}}){{/if}}</td>
            </tr>
            {{#if_eq isExplosive 'true'}}
              <tr>
                <td>{{localize "YZECORIOLIS.BlastPower"}}: {{blastPower}}</td>
                <td>{{localize "YZECORIOLIS.BlastRadius"}}: {{blastRadius}}</td>
              </tr>
            {{else}}
              <tr>
                <td>{{localize "YZECORIOLIS.Range"}}: {{range}}</td>
                <td>{{#if_eq isAutomatic 'true'}}{{localize "YZECORIOLIS.Automatic"}}-{{localize "YZECORIOLIS.Weapon"}}{{/if_eq}}</td>
              </tr>
            {{/if_eq}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
            {{/if}}
            <tr>
              <td colspan="2"><hr></td>
            </tr>
          {{/if_eq}}
          {{#if_eq rollType 'armor'}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
              <tr>
                <td colspan="2"><hr></td>
              </tr>
            {{/if}}
          {{/if_eq}}
          <tr>
          {{#if_eq rollType 'armor'}}
            {{#if combatOverhaul}}
            <td>{{localize "YZECORIOLIS.DamageReductionShort"}}: {{damageReduction}}</td>
            {{else}}
            <td>{{localize "YZECORIOLIS.ArmorRating"}}: {{bonus}}</td>
            {{/if}}
          {{else}}
            <td>{{attributeName}}: {{attribute}}</td>
            <td>{{#if skillName}}{{skillName}}: {{skill}}{{/if}}</td>
          {{/if_eq}}
          </tr>
          <tr>
            <td>{{localize "YZECORIOLIS.ModifierForRoll"}}: {{modifier}}</td>
            <td>{{#if_eq rollType 'armor'}}{{else if_eq rollType 'attribute'}}{{else if_eq rollType 'general'}}{{else if_eq rollType 'advanced'}}{{else}}{{localize "YZECORIOLIS.Bonus"}}: {{bonus}}{{/if_eq}}</td>
          </tr>
          {{#if itemModifiersChecked}}
            <tr>
              <td style="vertical-align: top;">{{localize "YZECORIOLIS.ItemModifiersOther"}}:</td>
              <td style="white-space: pre-wrap;">{{itemModifiersChecked}}</td>
            </tr>
          {{/if}}
        {{/if_eq}}
      <!-- additional roll-infos for npc -->
      {{else if_eq (AdditionalRollInfos) 'npc'}}
        {{#if_eq actorType 'npc'}}
          {{#if_eq rollType 'weapon'}}
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Damage"}}: {{damage}} {{#if damageText}}({{damageText}}){{/if}}{{#if combatOverhaul}}{{#if_gt armorPenetration 0}} | {{localize "YZECORIOLIS.ArmorPenetrationShort"}}: {{armorPenetration}}{{/if_gt}}{{/if}}</td>
            </tr>
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Crit"}}: {{#if_gt crit 0}}{{crit}}{{else}}-{{/if_gt}} {{#if critText}}({{critText}}){{/if}}</td>
            </tr>
            {{#if_eq isExplosive 'true'}}
              <tr>
                <td>{{localize "YZECORIOLIS.BlastPower"}}: {{blastPower}}</td>
                <td>{{localize "YZECORIOLIS.BlastRadius"}}: {{blastRadius}}</td>
              </tr>
            {{else}}
              <tr>
                <td>{{localize "YZECORIOLIS.Range"}}: {{range}}</td>
                <td>{{#if_eq isAutomatic 'true'}}{{localize "YZECORIOLIS.Automatic"}}-{{localize "YZECORIOLIS.Weapon"}}{{/if_eq}}</td>
              </tr>
            {{/if_eq}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
            {{/if}}
            <tr>
              <td colspan="2"><hr></td>
            </tr>
          {{/if_eq}}
          {{#if_eq rollType 'armor'}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
              <tr>
                <td colspan="2"><hr></td>
              </tr>
            {{/if}}
          {{/if_eq}}
          <tr>
          {{#if_eq rollType 'armor'}}
            {{#if combatOverhaul}}
            <td>{{localize "YZECORIOLIS.DamageReductionShort"}}: {{damageReduction}}</td>
            {{else}}
            <td>{{localize "YZECORIOLIS.ArmorRating"}}: {{bonus}}</td>
            {{/if}}
          {{else}}
            <td>{{attributeName}}: {{attribute}}</td>
            <td>{{#if skillName}}{{skillName}}: {{skill}}{{/if}}</td>
          {{/if_eq}}
          </tr>
          <tr>
            <td>{{localize "YZECORIOLIS.ModifierForRoll"}}: {{modifier}}</td>
            <td>{{#if_eq rollType 'armor'}}{{else if_eq rollType 'attribute'}}{{else if_eq rollType 'general'}}{{else if_eq rollType 'advanced'}}{{else}}{{localize "YZECORIOLIS.Bonus"}}: {{bonus}}{{/if_eq}}</td>
          </tr>
          {{#if itemModifiersChecked}}
            <tr>
              <td style="vertical-align: top;">{{localize "YZECORIOLIS.ItemModifiersOther"}}:</td>
              <td style="white-space: pre-wrap;">{{itemModifiersChecked}}</td>
            </tr>
          {{/if}}
        {{/if_eq}}
      <!-- additional roll-infos for all -->
      {{else if_eq (AdditionalRollInfos) 'all'}}
          {{#if_eq rollType 'weapon'}}
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Damage"}}: {{damage}} {{#if damageText}}({{damageText}}){{/if}}{{#if combatOverhaul}}{{#if_gt armorPenetration 0}} | {{localize "YZECORIOLIS.ArmorPenetrationShort"}}: {{armorPenetration}}{{/if_gt}}{{/if}}</td>
            </tr>
            <tr>
              <td colspan="2">{{localize "YZECORIOLIS.Crit"}}: {{#if_gt crit 0}}{{crit}}{{else}}-{{/if_gt}} {{#if critText}}({{critText}}){{/if}}</td>
            </tr>
            {{#if_eq isExplosive 'true'}}
              <tr>
                <td>{{localize "YZECORIOLIS.BlastPower"}}: {{blastPower}}</td>
                <td>{{localize "YZECORIOLIS.BlastRadius"}}: {{blastRadius}}</td>
              </tr>
            {{else}}
              <tr>
                <td>{{localize "YZECORIOLIS.Range"}}: {{range}}</td>
                <td>{{#if_eq isAutomatic 'true'}}{{localize "YZECORIOLIS.Automatic"}}-{{localize "YZECORIOLIS.Weapon"}}{{/if_eq}}</td>
              </tr>
            {{/if_eq}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
            {{/if}}
            <tr>
              <td colspan="2"><hr></td>
            </tr>
          {{/if_eq}}
          {{#if_eq rollType 'armor'}}
            {{#if features}}
              <tr>
                <td colspan="2">{{localize "YZECORIOLIS.Features"}}: {{features}}</td>
              </tr>
              <tr>
                <td colspan="2"><hr></td>
              </tr>
            {{/if}}
          {{/if_eq}}
          <tr>
          {{#if_eq rollType 'armor'}}
            {{#if combatOverhaul}}
            <td>{{localize "YZECORIOLIS.DamageReductionShort"}}: {{damageReduction}}</td>
            {{else}}
            <td>{{localize "YZECORIOLIS.ArmorRating"}}: {{bonus}}</td>
            {{/if}}
          {{else}}
            <td>{{attributeName}}: {{attribute}}</td>
            <td>{{#if skillName}}{{skillName}}: {{skill}}{{/if}}</td>
          {{/if_eq}}
          </tr>
          <tr>
            <td>{{localize "YZECORIOLIS.ModifierForRoll"}}: {{modifier}}</td>
            <td>{{#if_eq rollType 'armor'}}{{else if_eq rollType 'attribute'}}{{else if_eq rollType 'general'}}{{else if_eq rollType 'advanced'}}{{else}}{{localize "YZECORIOLIS.Bonus"}}: {{bonus}}{{/if_eq}}</td>
          </tr>
          {{#if itemModifiersChecked}}
            <tr>
              <td style="vertical-align: top;">{{localize "YZECORIOLIS.ItemModifiersOther"}}:</td>
              <td style="white-space: pre-wrap;">{{itemModifiersChecked}}</td>
            </tr>
          {{/if}}
      {{/if_eq}}
    <!-- total dice sum -->
      <tr>
        <td colspan="2">
        {{#if_gt totalDice 0}}
          <strong>{{localize "YZECORIOLIS.RollTotal"}}:</strong> {{totalDice}}d6
          {{#if_eq isAutomaticActive 'true'}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;+ {{localize "YZECORIOLIS.AutomaticFire"}}
          {{#if_gt results.rollData.machineGunner 0}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;& {{localize "YZECORIOLIS.Talent"}} {{localize "YZECORIOLIS.TalentMachinegunner"}}{{/if_gt}}
          {{#if_gt results.rollData.highCapacity 0}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;& {{localize "YZECORIOLIS.Weapon"}} {{localize "YZECORIOLIS.FeatureWeaponHighCapacity"}}{{/if_gt}}{{/if_eq}}
        {{else}}
          <strong>{{localize "YZECORIOLIS.RollTotal"}}:</strong> {{localize "YZECORIOLIS.RollSubstitute"}} {{totalDice}}d6
          {{#if_eq isAutomaticActive 'true'}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;+ {{localize "YZECORIOLIS.AutomaticFire"}}
          {{#if_gt results.rollData.machineGunner 0}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;& {{localize "YZECORIOLIS.Talent"}} {{localize "YZECORIOLIS.TalentMachinegunner"}}{{/if_gt}}
          {{#if_gt results.rollData.highCapacity 0}}<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;& {{localize "YZECORIOLIS.Weapon"}} {{localize "YZECORIOLIS.FeatureWeaponHighCapacity"}}{{/if_gt}}{{/if_eq}}
        {{/if_gt}}
        </td>
      </tr>
    </table>
    </div>
    <div class="dice-result">
        {{#if results.limitedSuccess}}
        <h4 class="dice-total limitedSuccess">{{localize "YZECORIOLIS.RollLimitedSucces"}} ({{results.successes}})</h4>
        {{/if}}
        {{#if results.failure}}
        <h4 class="dice-total criticalfailure">{{localize "YZECORIOLIS.RollFailure"}}</h4>
        {{/if}}
        {{#if results.criticalSuccess}}
        <h4 class="dice-total criticalSuccess">{{localize "YZECORIOLIS.RollCriticalSucces"}} ({{results.successes}})</h4>
        {{/if}}
        {{{tooltip}}}
        {{#if canPush}}
        <div class="dice-formula dice-push yzecoriolis">
            <a>
                <span>{{localize "YZECORIOLIS.PrayToIcons"}}</span>
                {{#if icon}}
                <span> - {{icon}}</span>
                {{/if}}
            </a>
        </div>
        {{else}}
        <div class="dice-formula dice-push yzecoriolis">
            <em>{{localize "YZECORIOLIS.PushedRoll"}}</em>
            {{#if prayerBonus}}
              <em> (+{{prayerBonus}})</em>
            {{/if}}
            {{#if prayerModifiersChecked}}
              <br>
              <em>{{prayerModifiersChecked}}</em>
            {{/if}}
        </div>
        {{/if}}
    </div>
    {{!-- Combat Overhaul Damage Calculator --}}
    {{#if combatOverhaul}}
      {{#if_eq rollType 'weapon'}}
        {{#unless results.failure}}
        <div class="damage-calculator-section">
          <hr>
          <details class="damage-calculator">
            <summary><strong>{{localize "YZECORIOLIS.DamageCalculator"}}</strong></summary>
            <div class="damage-calc-inputs" style="margin-top: 0.5em;">
              <div class="flexrow" style="gap: 0.5em; align-items: center;">
                <label style="flex: 1;">{{localize "YZECORIOLIS.ExtraDamage"}}:</label>
                <input type="number" class="calc-extra-damage" value="0" min="0" max="{{results.successes}}" style="width: 3em; text-align: center;">
              </div>
              <div class="flexrow" style="gap: 0.5em; align-items: center; margin-top: 0.3em;">
                <label style="flex: 1;">{{localize "YZECORIOLIS.TargetDR"}}:</label>
                <input type="number" class="calc-target-dr" value="0" min="0" max="10" style="width: 3em; text-align: center;">
              </div>
              <input type="hidden" class="calc-base-damage" value="{{damage}}">
              <input type="hidden" class="calc-armor-pen" value="{{armorPenetration}}">
              <input type="hidden" class="calc-crit-threshold" value="{{crit}}">
              <button type="button" class="calc-damage-btn" style="margin-top: 0.5em; width: 100%;">{{localize "YZECORIOLIS.Calculate"}}</button>
            </div>
            <div class="damage-calc-result" style="margin-top: 0.5em; display: none;">
              <table style="border: 0; width: 100%;">
                <tr>
                  <td>{{localize "YZECORIOLIS.EffectiveDR"}}:</td>
                  <td class="result-effective-dr" style="text-align: right; font-weight: bold;">-</td>
                </tr>
                <tr>
                  <td>{{localize "YZECORIOLIS.FinalDamage"}}:</td>
                  <td class="result-final-damage" style="text-align: right; font-weight: bold;">-</td>
                </tr>
              </table>
              <div class="result-critical" style="display: none; text-align: center; margin-top: 0.5em; padding: 0.3em; background: #8b0000; color: white; font-weight: bold;">
                {{localize "YZECORIOLIS.CriticalTriggered"}}
                <div class="result-crit-severity" style="font-size: 0.9em; font-weight: normal;"></div>
              </div>
              <button type="button" class="roll-suppression-btn" style="margin-top: 0.5em; width: 100%;">
                <i class="fas fa-shield-alt"></i> {{localize "YZECORIOLIS.SuppressionCheck"}}
              </button>
            </div>
          </details>
        </div>
        {{/unless}}
      {{/if_eq}}
    {{/if}}
</div>

{{#if hasExtraText}}
<div class="extra-text gm-sensitive">{{{extraText}}}</div>
{{/if}}

{{#if hasProperties}}
{{#each properties as |prop|}}
<div class="flexcol property-group gm-sensitive">
    <label>{{prop.header}}</label>
    <div class="flexrow">
        {{#each prop.value as |v|}}
        <span class="tag">{{{v}}}</span>
        {{/each}}
    </div>
</div>
{{/each}}
{{/if}}
